<div class="search-bar">
  <% unless @query %>
    <nav class="browse-tabs">
      <%= link_to browse_fonds_path, class: "browse-tabs__tab #{"browse-tabs__tab--active" if @tab == "fonds"}" do %>
        <%= t("browse.fonds") %> <span class="browse-tabs__count"><%= @browse_counts[:fonds] %></span>
      <% end %>
      <%= link_to browse_origins_path, class: "browse-tabs__tab #{"browse-tabs__tab--active" if @tab == "origins"}" do %>
        <%= t("browse.origins") %> <span class="browse-tabs__count"><%= @browse_counts[:origins] %></span>
      <% end %>
      <%= link_to browse_dates_path, class: "browse-tabs__tab #{"browse-tabs__tab--active" if @tab == "dates"}" do %>
        <%= t("browse.dates") %> <span class="browse-tabs__count"><%= @browse_counts[:decades] %></span>
      <% end %>
    </nav>
  <% end %>
  <form class="search-bar__form">
    <% if @archive_node %>
      <input type="hidden" name="node_id" value="<%= @archive_node.id %>" />
    <% end %>
    <% if @date_from %>
      <input type="hidden" name="from" value="<%= @date_from %>" />
      <input type="hidden" name="to" value="<%= @date_to %>" />
    <% end %>
    <input type="text" name="q" value="<%= @query %>" placeholder="<%= t("search_placeholder", total: @total) %>" class="search__text-input" />
    <input type="submit" value="<%= t("search_button") %>" class="search__button" />
    <%= link_to "Suchhinweise", search_help_path, class: "search__help-link" %>
  </form>
</div>
<% if @archive_node %>
  <p class="search__node-filter">
    Suche in: <%= link_to @archive_node.name, archive_node_path(@archive_node) %>
    (<%= link_to "Filter entfernen", root_path(q: @query, from: @date_from, to: @date_to) %>)
  </p>
<% end %>
<% if @query %>
  <% if @search_error %>
    <hr />
    <h3>Suchanfrage konnte nicht verarbeitet werden.</h3>
    <p>Bitte prüfen Sie die Syntax Ihrer Anfrage. <%= link_to "Suchhinweise", search_help_path %></p>
  <% end %>
  <% if @facets %>
    <% content_for :container_class, "container__inner--wide" %>
    <div class="search-layout">
      <%= render "facets_sidebar" %>
      <div class="search-layout__content">
  <% end %>
      <% if @total_count > 0 %>
        <div class="search-results__header">
          <div class="search-results__info">
            <%= page_entries_info @results, entry_name: 'Aktenstück' %>
          </div>
          <div class="search-results__tools">
            <span class="search-results__sort">
              <% if params[:sort] == "call_number" %>
                <%= link_to "Relevanz", facet_url(remove: [:sort]) %> | <strong>Signatur</strong>
              <% else %>
                <strong>Relevanz</strong> | <%= link_to "Signatur", facet_url(add: { sort: "call_number" }) %>
              <% end %>
            </span>
            <form class="jump-to-page" action="<%= request.path %>" method="get">
              <% request.query_parameters.except(:page).each do |k, v| %>
                <input type="hidden" name="<%= k %>" value="<%= v %>" />
              <% end %>
              <label for="page-input"><%= t("browse.page") %>:</label>
              <input type="number" name="page" id="page-input" value="<%= @results.current_page %>" min="1" max="<%= @results.total_pages %>" class="jump-to-page__input" />
              <button type="submit" class="jump-to-page__button"><%= t("browse.go") %></button>
            </form>
          </div>
        </div>
        <div class="pagination">
          <%= paginate @results %>
        </div>
        <% @results.each do |archive_file| %>
          <%= render ResultComponent.new(query: @query, archive_file: archive_file) %>
        <% end %>
        <div class="pagination">
          <%= paginate @results %>
        </div>
      <% else %>
        <hr />
        <h3>Keine Akten gefunden.</h3>
      <% end %>
  <% if @facets %>
      </div>
    </div>
  <% end %>
<% else %>
  <% case @tab %>
  <% when "fonds" %>
    <%= render "browse_fonds" %>
  <% when "origins" %>
    <%= render "browse_origins" %>
  <% when "dates" %>
    <%= render "browse_dates" %>
  <% else %>
    <hr class="title-spacer">
    <h2>Was ist Quellenportal?</h2>
    <p>
      Quellenportal bietet eine einfache und schnelle Möglichkeit, die Bestände des Bundesarchivs zu durchsuchen.
      Dieses Angebot richtet sich vor allem an Personen, die für ihre Recherchen exakte textuelle Übereinstimmungen suchen und große Mengen an Ergebnissen schnell sichten möchten.
      Die hierfür benötigten Erschließungsinformationen stammen aus dem <a href="https://www.bundesarchiv.de/DE/Content/Artikel/Ueber-uns/Aus-unserer-Arbeit/open-data.html">Open-Data-Angebot</a> des Bundesarchivs.
    </p>
    <p>
      Gegenüber Bundessuche bietet Quellenportal folgende Erweiterungen:
    </p>
    <ul>
      <li><strong>Stöbern</strong> — Bestände, Provenienz und Zeiträume durchblättern, ohne einen Suchbegriff zu kennen</li>
      <li><strong>Bestandsnavigation</strong> — die Tektonik des Archivs als navigierbare Baumstruktur</li>
      <li><strong>Bestandsbezogene Suche</strong> — Suche auf einzelne Bestände eingrenzen</li>
      <li><strong>Suchoperatoren</strong> — AND, OR, NOT und Phrasensuche (<%= link_to "Suchhinweise", search_help_path %>)</li>
    </ul>
    <p>
      Weitere Optionen für die Suche in den Beständen des Bundesarchivs sind <a href="https://www.archivesportaleurope.net">Archives Portal Europe</a>,
      <a href="https://www.archivportal-d.de">Archivportal-D</a> und <a href="https://invenio.bundesarchiv.de">Invenio</a>.
      Invenio ist ein Angebot des Bundesarchivs und ist bei Treffern im Quellenportal verlinkt. Dort kann das Archivgut eingesehen und bestellt werden.
    </p>
  <% end %>
<% end %>
