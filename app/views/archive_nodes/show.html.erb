<form class="archive-node-search" action="<%= root_path %>">
  <input type="hidden" name="node_id" value="<%= @archive_node.id %>" />
  <input type="text" name="q" placeholder="In diesem Bestand suchen..." class="search__text-input" />
  <input type="submit" value="Suchen" class="search__button" />
</form>

<nav class="archive-node-menu">
  <ul class="archive-node-level" style="--level: 0">
    <li class="archive-node archive-node--tree archive-node--selected">
      <%= link_to @archive_node.parents.first.name, archive_node_path(@archive_node.parents.first), class: 'archive-node__link' %>
    </li>
  </ul>
  <% @archive_node.parents.each.with_index do |node, index| %>
    <ul class="archive-node-level" style="--level: <%= index + 1 %>">
      <% node.child_nodes.includes(:child_nodes).each do |child| %>
        <% is_selected = child.id == @archive_node.parents[index + 1]&.id %>
        <% is_leaf = child.child_nodes.empty? %>
        <li class="archive-node <%= "archive-node--selected" if is_selected %> <%= is_leaf ? "archive-node--leaf" : "archive-node--tree" %>">
          <%= link_to archive_node_path(child), class: 'archive-node__link' do %>
            <%= child.name %>
            <% if (count = @file_counts[child.id]) && count > 0 %>
              <span class="archive-node__count"><%= count %></span>
            <% end %>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% end %>
</nav>

<% @archive_node.archive_files.each do |archive_file| %>
  <%= render ResultComponent.new(archive_file: archive_file) %>
<% end %>

<script>
  document.querySelectorAll('.archive-node--selected').forEach((el) => {
    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
  });
</script>
